# Codebase Structure

**Analysis Date:** 2026-02-25

## Directory Layout

```
next-office/
├── .next/                      # Build output (generated by Next.js)
├── .planning/                  # GSD project planning directory
├── .claude/                    # Claude context storage
├── .git/                       # Git repository
├── LP/                         # EXCLUDED — separate sub-project with own .planning/ and .git
├── docs/                       # Documentation (if any)
├── node_modules/               # Dependencies
├── public/                     # Static assets (images, logos, favicon)
├── scripts/                    # Build/utility scripts (if any)
├── src/
│   ├── app/                    # Next.js App Router pages
│   │   ├── (main)/             # Main site route group
│   │   │   ├── (subdirectories for routes)
│   │   │   ├── api/            # Main site API routes
│   │   │   ├── layout.tsx       # Main site layout (Header, Footer, Tracking)
│   │   │   └── page.tsx         # Homepage
│   │   ├── (lp)/               # Landing page route group
│   │   │   ├── lp/[city]/       # LP pages for specific cities
│   │   │   ├── api/            # LP API routes
│   │   │   └── layout.tsx       # LP layout (GTM, minimal chrome)
│   │   ├── layout.tsx           # Root layout (HTML shell, fonts, metadata)
│   │   ├── robots.ts           # SEO robots.txt
│   │   └── sitemap.ts          # SEO sitemap
│   ├── components/             # React components
│   │   ├── lp/                 # LP-specific components (excluded from main analysis)
│   │   ├── ui/                 # shadcn/ui base components
│   │   ├── header.tsx          # Main site header with nav
│   │   ├── footer.tsx          # Footer (shared across groups)
│   │   ├── lead-form.tsx       # Lead capture form (reusable)
│   │   ├── lead-dialog.tsx     # Lead form in dialog
│   │   ├── listing-card.tsx    # Office listing card with carousel
│   │   ├── listing-map.tsx     # Single listing map wrapper
│   │   ├── search-map.tsx      # Search page map wrapper
│   │   ├── search-bar.tsx      # Homepage/header search input
│   │   ├── photo-gallery.tsx   # Fullscreen photo gallery
│   │   ├── tracking-provider.tsx # Google Ads tracking context
│   │   └── markdown-content.tsx # For rendering blog posts
│   ├── lib/                    # Utilities and business logic
│   │   ├── lp/                 # LP-specific utilities (variants, data)
│   │   ├── types.ts            # TypeScript interfaces (Listing, City)
│   │   ├── listings.ts         # Data access: getListingBySlug, getListingsByCity, etc.
│   │   ├── utils.ts            # General utilities (className helpers, etc.)
│   │   ├── blog.ts             # Blog post utilities (if used)
│   │   ├── map-config.ts       # Mapbox GL configuration
│   │   └── testimonials.ts     # Static testimonial data
│   ├── content/                # Content files
│   │   └── blog/               # Markdown blog posts
│   ├── data/                   # Static JSON data
│   │   ├── listings.json       # All office listings (630KB, ~2000+ listings)
│   │   └── cities.json         # Cities metadata
│   └── middleware.ts           # Next.js middleware for cookie tracking
├── package.json                # Dependencies and scripts
├── tsconfig.json               # TypeScript configuration with @ alias
├── next.config.ts              # Next.js config (image remotePatterns)
├── .env.local                  # Local environment variables (secrets — not committed)
└── README.md (if present)      # Project overview
```

## Directory Purposes

**src/app:**
- Purpose: Next.js App Router file structure for pages and API routes
- Contains: Route groups `(main)` and `(lp)`, layouts, pages, API handlers
- Key files: `layout.tsx` (root), `(main)/page.tsx` (homepage), `(main)/[city]/page.tsx` (city search)

**src/app/(main):**
- Purpose: Main website user journey — discovery, search, listing detail, contact
- Contains: Public pages (home, search, cities, listings, blog, contact, legal pages), API routes
- Key files:
  - `page.tsx`: Homepage with hero, cities, testimonials
  - `[city]/page.tsx`: City search page with listings grid + map
  - `[city]/[listing]/page.tsx`: Listing detail page with full info
  - `search/page.tsx`: Global search page (all listings)
  - `api/leads/route.ts`: Lead form submission handler
  - `api/transit/route.ts`: Mapbox transit data proxy
  - `api/districts/route.ts`: District boundary data (if used)
  - `api/transit-lines/route.ts`: Transit line data (if used)

**src/app/(lp):**
- Purpose: Landing pages for paid acquisition campaigns (separate GTM tracking, no Header)
- Contains: LP-specific pages, thank-you pages, LP API routes
- Key files:
  - `lp/[city]/page.tsx`: City-specific LP landing page
  - `lp/[city]/danke/page.tsx`: Thank-you page with conversion tracking
  - `api/lp-leads/route.ts`: LP lead submission handler (similar to main leads but LP-specific)

**src/components:**
- Purpose: Reusable React components for UI rendering
- Contains: Forms, cards, maps, dialogs, headers, footers, galleries
- Key patterns:
  - UI components in `ui/`: Base shadcn components (button, input, label, select, dialog, sheet)
  - Business components: `listing-card.tsx`, `lead-form.tsx`, `search-map.tsx`
  - State-heavy components marked with "use client"
  - Presentational components accept data via props

**src/lib:**
- Purpose: Business logic, data access, and utilities
- Contains: TypeScript functions and constants
- Key modules:
  - `listings.ts`: Exports listings/cities arrays and accessor functions
  - `types.ts`: TypeScript interfaces for Listing and City
  - `map-config.ts`: Mapbox GL token and style configuration
  - `utils.ts`: Generic utilities (className merging, etc.)
  - `testimonials.ts`: Static testimonial data for homepage

**src/data:**
- Purpose: Static JSON data files
- Contains: `listings.json` (all offices), `cities.json` (city metadata)
- Non-committed: Generated or fetched from external source, checked in for deploy-time access
- Accessed via: `src/lib/listings.ts` imports

**src/content/blog:**
- Purpose: Markdown files for blog posts (if blog feature is active)
- Contains: .md files with frontmatter (title, date, etc.)
- Pattern: Gray-matter used to parse frontmatter + content

**public:**
- Purpose: Static assets served directly (images, logos, favicon)
- Key files: `/hero-office.jpg`, `/logo-*.svg`, `/team-benjamin.jpg`, `/placeholder-office.jpg`

## Key File Locations

**Entry Points:**
- `src/app/layout.tsx`: Root HTML shell, metadata, fonts, base config
- `src/app/(main)/page.tsx`: Homepage (GET `/`)
- `src/app/(main)/[city]/page.tsx`: City search (GET `/{city}`)
- `src/app/(main)/[city]/[listing]/page.tsx`: Listing detail (GET `/{city}/{listing}`)
- `src/app/(lp)/lp/[city]/page.tsx`: LP landing page (GET `/lp/{city}`)

**Configuration:**
- `tsconfig.json`: TypeScript config, path alias `@/*` → `src/*`
- `next.config.ts`: Mapbox image remotePatterns
- `package.json`: Dependencies (Next.js 16, React 19, Tailwind 4, Mapbox, Supabase, Resend)
- `.env.local`: Secrets (API keys — not committed)

**Core Logic:**
- `src/lib/listings.ts`: Listing accessor functions
- `src/middleware.ts`: Google Ads click ID tracking middleware
- `src/app/(main)/api/leads/route.ts`: Lead capture and persistence

**Components:**
- `src/components/lead-form.tsx`: Lead form logic (validation, submission, hydration handling)
- `src/components/listing-card.tsx`: Office card with image carousel
- `src/components/search-map-inner.tsx`: Mapbox GL map with listener integration
- `src/components/tracking-provider.tsx`: Google Ads URL parameter context

**Testing:**
- Tests not detected (no `.test.ts` or `.spec.ts` files present)
- No test config (jest.config.ts, vitest.config.ts not present)

## Naming Conventions

**Files:**
- PascalCase for React components: `ListingCard.tsx`, `LeadForm.tsx`, `SearchMap.tsx`
- kebab-case for utilities and pages: `map-config.ts`, `lead-form.tsx`, `page.tsx`, `route.ts`
- Route segments in brackets: `[city]`, `[listing]`, `[slug]` for dynamic routes
- Route group folders in parentheses: `(main)`, `(lp)` for logical grouping without URL impact

**Directories:**
- Lowercase plural for collections: `components/`, `lib/`, `data/`, `content/`, `scripts/`
- Parentheses for route groups: `(main)`, `(lp)`
- Square brackets for route parameters: `[city]`, `[slug]`

**Functions and Variables:**
- camelCase for functions: `getListingBySlug()`, `displayPrice()`, `handleSubmit()`
- CONSTANT_CASE for exported constants: `TRACKING_KEYS`, `CTA_POSITION`, `MAX_AGE`
- Prefixed state hooks: `hoveredId`, `submitted`, `showMap`

**Types and Interfaces:**
- PascalCase for types: `Listing`, `City`, `TrackingData`, `LeadFormProps`

## Where to Add New Code

**New Feature (e.g., listing filters, saved listings):**
- Primary code: `src/app/(main)/[feature-name]/page.tsx` (new route) or new component in `src/components/`
- State management: React Context or component state (no external state manager)
- Backend logic: `src/app/(main)/api/[feature-name]/route.ts` for API endpoints
- Types: Add to `src/lib/types.ts`

**New Component/Module:**
- React component: `src/components/[component-name].tsx` (or `src/components/lp/[component-name].tsx` if LP-specific)
- Business logic: `src/lib/[module-name].ts`
- Import via `@/components/[component-name]` or `@/lib/[module-name]` (path alias configured in tsconfig.json)

**Utilities:**
- General utilities: `src/lib/utils.ts`
- Domain-specific: Create new file in `src/lib/` (e.g., `src/lib/search-utils.ts`)

**New API Route:**
- Location: `src/app/(main)/api/[route-name]/route.ts` for main site, `src/app/(lp)/api/[route-name]/route.ts` for LP
- Pattern: Export `async function GET|POST|PUT|DELETE(request: Request)`
- Use Supabase client for data, Resend for email, external APIs for integrations

**Styles:**
- Tailwind classes inline in JSX (utility-first approach)
- No separate CSS files (Tailwind CSS 4 configured)
- Global styles: `src/app/globals.css` (if needed — check for existing)

**Static Data:**
- Add to `src/data/*.json` and import via `src/lib/listings.ts`
- Or create new `.ts` file in `src/lib/` to import JSON data

## Special Directories

**src/.next:**
- Purpose: Next.js build output (build artifacts, server functions compiled code)
- Generated: Yes (created by `npm run build`)
- Committed: No (added to .gitignore)

**src/.planning:**
- Purpose: GSD project planning (ROADMAP.md, PROJECT.md, STATE.md, milestones/)
- Generated: No (hand-written)
- Committed: Yes

**LP/ subdirectory:**
- Purpose: Separate sub-project for A/B testing landing pages
- Generated: No (separate Git repo)
- Committed: No (excluded from main project analysis)
- Status: Has its own `.planning/` and `.git` — treat as independent

**node_modules:**
- Purpose: Installed npm dependencies
- Generated: Yes (created by `npm install`)
- Committed: No (added to .gitignore)

---

*Structure analysis: 2026-02-25*
