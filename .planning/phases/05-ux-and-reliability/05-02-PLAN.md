---
phase: 05-ux-and-reliability
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/lead-form.tsx
  - src/components/footer.tsx
autonomous: true
requirements: [UX-04, UX-06, UX-08, UX-11, REL-02]

must_haves:
  truths:
    - "The email input field has type='email' so mobile keyboards show the @ key and browsers validate format natively"
    - "The footer copyright year does not cause a hydration mismatch between server and client renders"
    - "The lead form skeleton/loading state includes aria-busy='true' for screen readers"
    - "The lead form submit button shows a visible spinner icon during submission, not just text change"
    - "Rapidly navigating between city pages does not cause hydration errors in the lead form"
  artifacts:
    - path: "src/components/lead-form.tsx"
      provides: "Email type=email, aria-busy skeleton, spinner button, stable hydration"
      contains: "type=\"email\""
    - path: "src/components/footer.tsx"
      provides: "Server-safe year rendering without hydration mismatch"
  key_links:
    - from: "src/components/lead-form.tsx"
      to: "/api/leads"
      via: "fetch POST on submit"
      pattern: "fetch.*api/leads"
---

<objective>
Polish the lead form UX (email input type, loading spinner, accessible skeleton, hydration stability) and fix the footer year hydration mismatch.

Purpose: Forms must feel responsive and accessible. The footer year must not flash or cause React hydration warnings. Rapid navigation must not break the lead form.

Output: 2 modified component files with 5 UX/reliability improvements.
</objective>

<execution_context>
@/Users/szymonwilkosz/.claude/get-shit-done/workflows/execute-plan.md
@/Users/szymonwilkosz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

<interfaces>
<!-- Key types and contracts the executor needs. -->

From src/components/lead-form.tsx (current state):
```typescript
// Email input currently uses type="text" with inputMode="email":
<Input id="lead_mail" name="lead_mail" type="text" inputMode="email" ... />

// Skeleton already exists (lines 127-138) but has no aria-busy:
if (!mounted) {
  return (
    <div className={`flex flex-col gap-4 ...`} style={{ minHeight: ... }} />
  );
}

// Submit button currently shows text change, no spinner icon:
<Button type="submit" size="lg" className="w-full" disabled={submitting}>
  <Send className="mr-2 h-4 w-4" />
  {submitting ? "Wird gesendet..." : "Anfrage senden"}
</Button>

// State: const [submitting, setSubmitting] = useState(false);
```

From src/components/footer.tsx (current state — NOT a client component):
```typescript
// Footer is a server component (no "use client" directive)
// The year is rendered with new Date().getFullYear() inline:
<div className="mt-12 border-t pt-8 text-center text-sm text-muted-text">
  © {new Date().getFullYear()} NextOffice. Alle Rechte vorbehalten.
</div>
// This causes hydration mismatch if server render time crosses midnight vs client render
```
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix email input type, add aria-busy skeleton, and add submit spinner</name>
  <files>src/components/lead-form.tsx</files>
  <action>
**1. Change email input type** (UX-04):
- Change `type="text"` to `type="email"` on the email input (line ~189)
- Keep `inputMode="email"` as a fallback for older browsers
- Keep `autoComplete="one-time-code"` to suppress password manager autofill

**2. Add aria-busy to skeleton** (UX-08):
- In the `if (!mounted)` block (line ~127), add `aria-busy="true"` and `role="status"` to the skeleton div
- Add a visually hidden span inside: `<span className="sr-only">Formular wird geladen...</span>`
- The sr-only class should be: `className="absolute w-px h-px p-0 -m-px overflow-hidden whitespace-nowrap border-0"` (or use Tailwind `sr-only` if available)

**3. Add spinner to submit button** (UX-11):
- Import `Loader2` from "lucide-react" (standard spinning icon)
- When `submitting` is true, show `<Loader2 className="mr-2 h-4 w-4 animate-spin" />` instead of the `<Send>` icon
- Keep the text change: "Wird gesendet..." when submitting, "Anfrage senden" when idle
- Result: `{submitting ? <Loader2 className="mr-2 h-4 w-4 animate-spin" /> : <Send className="mr-2 h-4 w-4" />}`

**4. Ensure stable hydration on rapid navigation** (REL-02):
- The lead form already uses `useEffect(() => setMounted(true), []);` which handles hydration
- Add a `key` prop approach: the LeadForm receives `citySlug` as a prop — when the user navigates between cities, React should remount the form
- In `src/components/city-listings-client.tsx`, the LeadDialog already receives `citySlug` — verify the LeadForm inside it gets `citySlug` passed through
- The issue is that rapid navigation may leave stale state. Add `useEffect` cleanup: when `citySlug` changes, reset form states:
  ```typescript
  useEffect(() => {
    setSubmitted(false);
    setError(false);
    setSubmitting(false);
  }, [citySlug]);
  ```
- This ensures changing cities resets the form state without a full remount (which would cause flicker)
  </action>
  <verify>
```bash
grep -q 'type="email"' src/components/lead-form.tsx && echo "Email type OK"
grep -q 'aria-busy' src/components/lead-form.tsx && echo "aria-busy OK"
grep -q 'Loader2' src/components/lead-form.tsx && echo "Spinner import OK"
grep -q 'animate-spin' src/components/lead-form.tsx && echo "Spinner animation OK"
npx tsc --noEmit
```
  </verify>
  <done>
- Email input has type="email" for native validation and mobile keyboard (UX-04)
- Skeleton has aria-busy="true" and screen reader text (UX-08)
- Submit button shows animated spinner icon during submission (UX-11)
- City slug changes reset form state without hydration errors (REL-02)
- TypeScript compiles with zero errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix footer year hydration mismatch</name>
  <files>src/components/footer.tsx</files>
  <action>
**Fix the year rendering in Footer** (UX-06):

The Footer component is a server component (no "use client"). The `new Date().getFullYear()` call runs on the server at build/render time and on the client at hydration time. If the server builds near midnight and the client loads after midnight, the year differs causing a hydration mismatch.

**Solution**: Hard-code the year as a constant since the footer is a server component and the site rebuilds regularly. This eliminates the hydration mismatch entirely.

- Replace `© {new Date().getFullYear()} NextOffice. Alle Rechte vorbehalten.`
- With: `© 2026 NextOffice. Alle Rechte vorbehalten.`

**Why hard-code instead of suppressHydrationWarning**:
- suppressHydrationWarning only suppresses the warning, doesn't fix the flash
- A hard-coded year in a server component is rendered identically on server and client
- The year changes once per year and will be updated during any future deploy
- Alternative: Add `suppressHydrationWarning` to the div if the team prefers dynamic year. Both approaches satisfy the requirement, but hard-coding is simpler and fully deterministic.

**Actually, better approach — use suppressHydrationWarning** since this is more maintainable:
- Add `suppressHydrationWarning` to the div containing the year
- This is the standard Next.js pattern for date-dependent content
- The body and html tags in root layout already use this pattern

Change:
```tsx
<div className="mt-12 border-t pt-8 text-center text-sm text-muted-text">
  © {new Date().getFullYear()} NextOffice. Alle Rechte vorbehalten.
</div>
```
To:
```tsx
<div className="mt-12 border-t pt-8 text-center text-sm text-muted-text" suppressHydrationWarning>
  © {new Date().getFullYear()} NextOffice. Alle Rechte vorbehalten.
</div>
```
  </action>
  <verify>
```bash
grep -q 'suppressHydrationWarning' src/components/footer.tsx && echo "Footer hydration fix OK"
npx tsc --noEmit
```
  </verify>
  <done>
- Footer year rendering does not produce React hydration mismatch warnings (UX-06)
- TypeScript compiles with zero errors
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` — zero TypeScript errors
2. Email input in lead-form.tsx uses `type="email"`
3. Lead form skeleton has `aria-busy="true"`
4. Submit button shows `Loader2` spinner with `animate-spin` during submission
5. Footer div has `suppressHydrationWarning`
6. Lead form resets state when citySlug changes
</verification>

<success_criteria>
- Email input has type="email" (mobile keyboard shows @ key)
- Footer year does not cause hydration mismatch
- Lead form skeleton announces loading state to screen readers
- Submit button shows spinning icon during submission
- Navigating between cities resets lead form state cleanly
- TypeScript compiles cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/05-ux-and-reliability/05-02-SUMMARY.md`
</output>
