---
phase: 06-seo-and-analytics
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/(main)/layout.tsx
  - src/components/lead-form.tsx
  - src/app/layout.tsx
  - src/components/search-listings-client.tsx
autonomous: true
requirements:
  - SEO-01
  - SEO-07
  - SEO-10
  - SEO-11

must_haves:
  truths:
    - "GA4 page_view events fire on all main site pages (homepage, city, listing, search, blog, contact)"
    - "Lead form submission on main site fires a GA4 generate_lead event via window.gtag"
    - "Font includes latin-ext subset for German special characters"
    - "Search page has a semantic h1 heading visible to crawlers"
  artifacts:
    - path: "src/app/(main)/layout.tsx"
      provides: "GTMScript component rendered in main site layout"
      contains: "GTMScript"
    - path: "src/components/lead-form.tsx"
      provides: "gtag generate_lead event fired on successful submission"
      contains: "gtag"
    - path: "src/app/layout.tsx"
      provides: "Inter font with latin-ext subset"
      contains: "latin-ext"
    - path: "src/components/search-listings-client.tsx"
      provides: "Semantic h1 heading on search page"
      contains: "<h1"
  key_links:
    - from: "src/app/(main)/layout.tsx"
      to: "src/components/lp/tracking/gtm-script.tsx"
      via: "import GTMScript"
      pattern: "import.*GTMScript"
    - from: "src/components/lead-form.tsx"
      to: "window.gtag"
      via: "gtag call after successful form submission"
      pattern: "window\\.gtag"
---

<objective>
Add GA4 analytics tracking to all main site pages, fire conversion events on lead form submission, add latin-ext font subset, and add semantic h1 to search page.

Purpose: Main site pages currently have zero analytics tracking (GA4 only exists on LP pages). The lead form fires no conversion event. The font lacks German character support. The search page lacks an h1 for SEO.

Output: GA4 fires page_view on every main site page load, lead form fires generate_lead on submit, font includes latin-ext, search page has h1.
</objective>

<execution_context>
@/Users/szymonwilkosz/.claude/get-shit-done/workflows/execute-plan.md
@/Users/szymonwilkosz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

<interfaces>
<!-- GTMScript is already implemented for LP pages. Reuse it for main site. -->

From src/components/lp/tracking/gtm-script.tsx:
```typescript
// Reads NEXT_PUBLIC_GA4_ID and NEXT_PUBLIC_GOOGLE_ADS_ID from env
// Renders nothing when both are unset (graceful degradation)
export function GTMScript(): JSX.Element | null;
```

From src/app/(main)/layout.tsx (current):
```typescript
import { Header } from "@/components/header";
import { Footer } from "@/components/footer";
import { TrackingProvider } from "@/components/tracking-provider";
// Renders: TrackingProvider > div > Header + main + Footer
```

From src/components/lead-form.tsx (current):
```typescript
// handleSubmit: sends POST to /api/leads, sets submitted=true on success
// No gtag call exists — needs adding after successful submission
```

From src/app/layout.tsx (current):
```typescript
const inter = Inter({
  variable: "--font-inter",
  subsets: ["latin"],  // Missing "latin-ext"
});
```

From src/components/search-listings-client.tsx (current):
```typescript
// No h1 element — starts with <p> showing listing count
// Need to add h1 above the listing content
```
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add GA4 tracking to main site and fix font subset</name>
  <files>src/app/(main)/layout.tsx, src/app/layout.tsx</files>
  <action>
1. In `src/app/(main)/layout.tsx`:
   - Import GTMScript from `@/components/lp/tracking/gtm-script` (reuse existing component, it already handles env var presence/absence gracefully)
   - Render `<GTMScript />` inside the layout, BEFORE the TrackingProvider wrapper. Place it as a sibling, not inside TrackingProvider. The GTMScript is a server component that injects script tags — it should be at the top level of the layout return.
   - Final structure: `<> <GTMScript /> <TrackingProvider> <div> <Header /> <main> <Footer /> </div> </TrackingProvider> </>`

2. In `src/app/layout.tsx`:
   - Change the Inter font `subsets` from `["latin"]` to `["latin", "latin-ext"]`
   - This adds support for German characters like umlauts and eszett that appear throughout the site
  </action>
  <verify>
    <automated>cd /Users/szymonwilkosz/Library/Mobile\ Documents/com~apple~CloudDocs/claude-config/projects/next-office && grep -q "GTMScript" src/app/\(main\)/layout.tsx && grep -q "latin-ext" src/app/layout.tsx && echo "PASS" || echo "FAIL"</automated>
  </verify>
  <done>GTMScript renders in main site layout (GA4 fires on all main pages when env var is set). Font includes latin-ext subset.</done>
</task>

<task type="auto">
  <name>Task 2: Add conversion tracking to main site lead form and h1 to search page</name>
  <files>src/components/lead-form.tsx, src/components/search-listings-client.tsx</files>
  <action>
1. In `src/components/lead-form.tsx`:
   - After the `setSubmitted(true)` line (inside the `if (res.ok)` success path of handleSubmit), add a gtag generate_lead event call:
     ```typescript
     // Fire GA4 lead conversion event (SEO-07)
     if (typeof window !== "undefined" && typeof window.gtag === "function") {
       window.gtag("event", "generate_lead", {
         event_category: "lead",
         event_label: citySlug || "general",
         value: 1,
       });
     }
     ```
   - Add the gtag type declaration at the top of the file (after imports, before component):
     ```typescript
     declare global {
       interface Window {
         gtag?: (...args: unknown[]) => void;
       }
     }
     ```
   - The typeof checks ensure this degrades gracefully when GA4 is not loaded (dev, or no env var)

2. In `src/components/search-listings-client.tsx`:
   - Add a semantic `<h1>` heading above the listings content. Inside the scrollable listing area (the div with `className="flex-1 overflow-y-auto..."`), add as the first child:
     ```tsx
     <h1 className="px-4 pt-4 text-2xl font-bold sm:text-3xl">Büros finden</h1>
     ```
   - Keep the existing `<p>` with the listing count below the h1
   - Remove the top padding from the existing `<p className="mb-4 text-sm text-body">` since the h1 now provides visual spacing
  </action>
  <verify>
    <automated>cd /Users/szymonwilkosz/Library/Mobile\ Documents/com~apple~CloudDocs/claude-config/projects/next-office && grep -q "generate_lead" src/components/lead-form.tsx && grep -q "<h1" src/components/search-listings-client.tsx && echo "PASS" || echo "FAIL"</automated>
  </verify>
  <done>Main site lead form fires GA4 generate_lead event on successful submission. Search page has a semantic h1 heading.</done>
</task>

</tasks>

<verification>
1. `grep "GTMScript" src/app/(main)/layout.tsx` — confirms GA4 script loaded on all main site pages
2. `grep "latin-ext" src/app/layout.tsx` — confirms font includes German character subset
3. `grep "generate_lead" src/components/lead-form.tsx` — confirms lead form fires conversion event
4. `grep "<h1" src/components/search-listings-client.tsx` — confirms search page has semantic h1
5. `npx tsc --noEmit` — TypeScript compiles without errors
</verification>

<success_criteria>
- GTMScript component is imported and rendered in `(main)/layout.tsx`
- Inter font subsets include both "latin" and "latin-ext"
- Lead form handleSubmit calls `window.gtag("event", "generate_lead", ...)` on success
- Search page renders an `<h1>` element with meaningful text
- All files compile without TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/06-seo-and-analytics/06-01-SUMMARY.md`
</output>
