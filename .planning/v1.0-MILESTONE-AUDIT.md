---
milestone: v1.0
audited: 2026-02-26
status: tech_debt
scores:
  requirements: 58/60
  phases: 6/6
  integration: 56/60
  flows: 5/5
gaps:
  requirements:
    - id: "SEC-12"
      status: "deferred"
      phase: "Phase 5"
      claimed_by_plans: ["05-03-PLAN.md"]
      completed_by_plans: []
      verification_status: "deferred"
      evidence: "Mapbox token URL restriction is a dashboard action, not code. User explicitly deferred during Phase 5 execution. Documented as post-launch task."
    - id: "DEV-03"
      status: "partial"
      phase: "Phase 2"
      claimed_by_plans: ["02-03-PLAN.md"]
      completed_by_plans: ["02-03-SUMMARY.md"]
      verification_status: "human_needed"
      evidence: "Sentry SDK fully wired (client + server + edge configs, withSentryConfig, error boundaries, instrumentation.ts). Code complete. Requires DSN credentials and production deploy for end-to-end verification."
  integration:
    - from: "lead-form-section.tsx"
      to: "Google Ads conversion"
      issue: "LP on-submit conversion tag uses hardcoded placeholder 'AW-XXXXXXXXXX/XXXXXXXXXX' instead of env vars. The danke page ConversionTracker reads env vars correctly."
      affected_requirements: ["DEV-07"]
      severity: "medium"
    - from: "service.ts dedup"
      to: "REL-06 guarantee"
      issue: "Dedup only runs when both phone AND city are present. API submissions without phone bypass dedup entirely — HTML form marks phone required so browser submissions protected."
      affected_requirements: ["REL-06"]
      severity: "low"
    - from: "search-map-inner.tsx"
      to: "lib/leads/email.ts escapeHtml"
      issue: "search-map-inner.tsx retains local escapeHtml copy. Phase 3 consolidation did not migrate map component. SEC-03 still satisfied (local copy works) but consolidation is incomplete."
      affected_requirements: ["REL-04"]
      severity: "low"
  flows: []
tech_debt:
  - phase: 01-security-hardening
    items:
      - "SUMMARY 01-01 frontmatter has empty requirements-completed — SEC-01, SEC-02, SEC-03 implemented but not listed"
  - phase: 02-infrastructure-foundations
    items:
      - "DEV-03: Sentry SDK wired but credentials not configured — needs SENTRY_DSN, SENTRY_AUTH_TOKEN, SENTRY_ORG, SENTRY_PROJECT"
      - "DEV-01: API routes read process.env.* directly instead of typed env accessor (startup validation still fires)"
  - phase: 03-lead-pipeline-hardening
    items:
      - "env.ts typed object not imported by Phase 3 modules — all use process.env.* with own null-guards"
      - "/api/districts route has no consumer in source — route exists but nothing fetches it"
      - "lead-form-section.tsx line 38: hardcoded AW-XXXXXXXXXX Google Ads placeholder"
      - "escapeHtml local copy in search-map-inner.tsx not migrated to shared module"
  - phase: 05-ux-and-reliability
    items:
      - "SEC-12: Mapbox token not restricted to allowed URLs in dashboard (deferred — post-launch action)"
---

# v1.0 Milestone Audit: next-office.io Launch Readiness

**Audited:** 2026-02-26
**Status:** TECH DEBT (no critical blockers, 8 deferred items)
**Milestone Goal:** Fix all P0s, all P1s, selected reliability issues, and quick P2 wins — making the platform safe to launch.

---

## Phase Summary

| Phase | Name | Plans | Verification | Status |
|-------|------|-------|-------------|--------|
| 1 | Security Hardening | 2/2 | passed (6/6) | ✓ Complete |
| 2 | Infrastructure Foundations | 4/4 | passed (9/10 + 1 human-needed) | ✓ Complete |
| 3 | Lead Pipeline Hardening | 2/2 | passed (5/5) | ✓ Complete |
| 4 | Performance Architecture | 3/3 | passed (12/12) | ✓ Complete |
| 5 | UX and Reliability | 3/3 | passed (6/6) | ✓ Complete |
| 6 | SEO and Analytics | 3/3 | passed (14/14) | ✓ Complete |

**All 6 phases verified. 17 plans executed. 52/54 must-haves verified automatically, 2 require human testing.**

---

## Requirements Coverage (3-Source Cross-Reference)

### Security (SEC-01 to SEC-12)

| Req | Description | VERIFICATION | SUMMARY | Traceability | Final |
|-----|-------------|-------------|---------|-------------|-------|
| SEC-01 | Overpass proxy parameterized | SATISFIED | — (frontmatter gap) | [x] Complete | **satisfied** |
| SEC-02 | lat/lng validated as numbers | SATISFIED | — (frontmatter gap) | [x] Complete | **satisfied** |
| SEC-03 | Transit popup HTML-escaped | SATISFIED | — (frontmatter gap) | [x] Complete | **satisfied** |
| SEC-04 | Email templates HTML-escape | SATISFIED | 01-02 | [x] Complete | **satisfied** |
| SEC-05 | Per-IP rate limiting | SATISFIED | 01-02 | [x] Complete | **satisfied** |
| SEC-06 | Security headers configured | SATISFIED | 02-02 | [x] Complete | **satisfied** |
| SEC-07 | CSRF protection | SATISFIED | 03-01, 03-02 | [x] Complete | **satisfied** |
| SEC-08 | RFC-compliant email validation | SATISFIED | 03-01, 03-02 | [x] Complete | **satisfied** |
| SEC-09 | Cookie values validated | SATISFIED | 03-01, 03-02 | [x] Complete | **satisfied** |
| SEC-10 | Scoped Supabase access | SATISFIED | 03-01, 03-02 | [x] Complete | **satisfied** |
| SEC-11 | Input size/type validation | SATISFIED | 03-01, 03-02 | [x] Complete | **satisfied** |
| SEC-12 | Mapbox token restricted | DEFERRED | — | [ ] Pending | **deferred** |

### Performance (PERF-01 to PERF-08)

| Req | Description | VERIFICATION | SUMMARY | Traceability | Final |
|-----|-------------|-------------|---------|-------------|-------|
| PERF-01 | Client JS payload reduced | SATISFIED | 04-01 | [x] Complete | **satisfied** |
| PERF-02 | Server components + client islands | SATISFIED | 04-02 | [x] Complete | **satisfied** |
| PERF-03 | Static generation | SATISFIED | 04-02 | [x] Complete | **satisfied** |
| PERF-04 | Mapbox lazy-loaded on viewport | SATISFIED | 04-03 | [x] Complete | **satisfied** |
| PERF-05 | Carousel renders only visible | SATISFIED | 04-03 | [x] Complete | **satisfied** |
| PERF-06 | Transit timeout + retry | SATISFIED | 04-01 | [x] Complete | **satisfied** |
| PERF-07 | Transit Cache-Control | SATISFIED | 04-01 | [x] Complete | **satisfied** |
| PERF-08 | LeadForm uses cities module | SATISFIED | 04-01 | [x] Complete | **satisfied** |

### UX / Frontend (UX-01 to UX-12)

| Req | Description | VERIFICATION | SUMMARY | Traceability | Final |
|-----|-------------|-------------|---------|-------------|-------|
| UX-01 | Custom branded 404 page | SATISFIED | 05-01 | [x] Complete | **satisfied** |
| UX-02 | Error boundaries | SATISFIED | 05-01 | [x] Complete | **satisfied** |
| UX-03 | Invalid city slugs → 404 | SATISFIED | 05-01 | [x] Complete | **satisfied** |
| UX-04 | Email type + validation | SATISFIED | 05-02 | [x] Complete | **satisfied** |
| UX-05 | Datenschutz Mapbox reference | SATISFIED | 05-01 | [x] Complete | **satisfied** |
| UX-06 | Footer year no hydration mismatch | SATISFIED | 05-02 | [x] Complete | **satisfied** |
| UX-07 | Search bar ARIA | SATISFIED | 05-03 | [x] Complete | **satisfied** |
| UX-08 | Lead form skeleton | SATISFIED | 05-02 | [x] Complete | **satisfied** |
| UX-09 | Photo gallery focus trap | SATISFIED | 05-03 | [x] Complete | **satisfied** |
| UX-10 | Zero-result empty state | SATISFIED | 05-01 | [x] Complete | **satisfied** |
| UX-11 | Submit spinner | SATISFIED | 05-02 | [x] Complete | **satisfied** |
| UX-12 | Decorative icons aria-hidden | SATISFIED | 05-03 | [x] Complete | **satisfied** |

### DevOps / Infrastructure (DEV-01 to DEV-07)

| Req | Description | VERIFICATION | SUMMARY | Traceability | Final |
|-----|-------------|-------------|---------|-------------|-------|
| DEV-01 | Env validation fails fast | SATISFIED | 02-01 | [x] Complete | **satisfied** |
| DEV-02 | .env.example documents all | SATISFIED | 02-01 | [x] Complete | **satisfied** |
| DEV-03 | Sentry error monitoring | NEEDS HUMAN | 02-03 | [ ] Pending | **partial** |
| DEV-04 | CI/CD runs lint + build | SATISFIED | 02-04 | [x] Complete | **satisfied** |
| DEV-05 | Health check endpoint | SATISFIED | 02-01 | [x] Complete | **satisfied** |
| DEV-06 | CORS restricts origins | SATISFIED | 02-02 | [x] Complete | **satisfied** |
| DEV-07 | Google Ads placeholders | SATISFIED | 02-01 | [x] Complete | **satisfied** |

### SEO / Analytics (SEO-01 to SEO-11)

| Req | Description | VERIFICATION | SUMMARY | Traceability | Final |
|-----|-------------|-------------|---------|-------------|-------|
| SEO-01 | GA4 tracking all main pages | SATISFIED | 06-01 | [x] Complete | **satisfied** |
| SEO-02 | Default OG image in root | SATISFIED | 06-02 | [x] Complete | **satisfied** |
| SEO-03 | Homepage metadata export | SATISFIED | 06-02 | [x] Complete | **satisfied** |
| SEO-04 | Organization structured data | SATISFIED | 06-02 | [x] Complete | **satisfied** |
| SEO-05 | BreadcrumbList listing + blog | SATISFIED | 06-03 | [x] Complete | **satisfied** |
| SEO-06 | /contact in sitemap | SATISFIED | 06-02 | [x] Complete | **satisfied** |
| SEO-07 | Lead form conversion tracking | SATISFIED | 06-01 | [x] Complete | **satisfied** |
| SEO-08 | ueber-uns/fuer-anbieter OG | SATISFIED | 06-02 | [x] Complete | **satisfied** |
| SEO-09 | robots.txt blocks /api/, /lp/ | SATISFIED | 06-02 | [x] Complete | **satisfied** |
| SEO-10 | Search page h1 heading | SATISFIED | 06-01 | [x] Complete | **satisfied** |
| SEO-11 | Font latin-ext subset | SATISFIED | 06-01 | [x] Complete | **satisfied** |

### Reliability (REL-01 to REL-06)

| Req | Description | VERIFICATION | SUMMARY | Traceability | Final |
|-----|-------------|-------------|---------|-------------|-------|
| REL-01 | Listings without coords handled | SATISFIED | 05-03 | [x] Complete | **satisfied** |
| REL-02 | Rapid navigation no hydration | SATISFIED | 05-02 | [x] Complete | **satisfied** |
| REL-03 | localStorage exceptions caught | SATISFIED | 05-03 | [x] Complete | **satisfied** |
| REL-04 | Lead routes consolidated | SATISFIED | 03-01, 03-02 | [x] Complete | **satisfied** |
| REL-05 | Email non-blocking | SATISFIED | 03-01, 03-02 | [x] Complete | **satisfied** |
| REL-06 | Duplicate leads detected | SATISFIED | 03-01, 03-02 | [x] Complete | **satisfied** |

### Quick Wins (QW-01 to QW-04)

| Req | Description | VERIFICATION | SUMMARY | Traceability | Final |
|-----|-------------|-------------|---------|-------------|-------|
| QW-01 | X-Powered-By removed | SATISFIED | 02-02 | [x] Complete | **satisfied** |
| QW-02 | JSON-LD escapes script tags | SATISFIED | 06-03 | [x] Complete | **satisfied** |
| QW-03 | Blog dateModified | SATISFIED | 06-03 | [x] Complete | **satisfied** |
| QW-04 | Legal pages canonical URLs | SATISFIED | 06-02 | [x] Complete | **satisfied** |

---

## Cross-Phase Integration

**Connected:** 56/60 requirement integration paths verified
**Partial:** 4 paths (DEV-01 env accessor, DEV-07 LP placeholder, REL-04 escapeHtml dup, REL-06 phoneless dedup)
**Orphaned exports:** 0
**Orphaned routes:** 1 (/api/districts — no consumer)

### E2E Flows

| Flow | Phases | Status |
|------|--------|--------|
| Lead form → CSRF → validation → Supabase → email → GA4 | 3 + 6 | ✓ Complete |
| LP form → CSRF → validation → Supabase → email → danke conversion | 3 + 2 | ✓ Complete |
| Search/city SSR → data split → lazy Mapbox → GA4 | 4 + 6 | ✓ Complete |
| Security headers → CORS → all API routes | 1 + 2 + 3 | ✓ Complete |
| Error boundary → Sentry → 404 pages | 2 + 5 | ✓ Complete |

### Integration Findings

1. **DEV-07 — LP on-submit conversion placeholder** (medium): `lead-form-section.tsx` fires hardcoded `AW-XXXXXXXXXX` — danke page `ConversionTracker` works correctly via env vars
2. **REL-06 — Dedup bypass for phoneless leads** (low): Dedup requires phone AND city. HTML form marks phone required, so browser submissions protected. API-direct without phone bypasses dedup.
3. **REL-04 — escapeHtml duplication** (low): `search-map-inner.tsx` retains local copy. SEC-03 still satisfied; consolidation incomplete.

---

## Tech Debt Summary

### 8 items across 4 phases

**Phase 1: Security Hardening**
- 01-01-SUMMARY.md frontmatter has empty requirements-completed (SEC-01/02/03 implemented but not listed)

**Phase 2: Infrastructure Foundations**
- DEV-03: Sentry SDK fully wired but untested end-to-end (requires DSN credentials + production deploy)
- DEV-01: API routes read `process.env.*` directly instead of typed `env` accessor (no runtime impact)

**Phase 3: Lead Pipeline Hardening**
- `env.ts` typed object not imported by Phase 3 modules (pattern inconsistency, not a bug)
- `/api/districts` route has no consumer in source
- `lead-form-section.tsx` Google Ads on-submit conversion tag has hardcoded placeholder
- `search-map-inner.tsx` escapeHtml not migrated to shared module

**Phase 5: UX and Reliability**
- SEC-12: Mapbox token not restricted in dashboard (deferred — post-launch action)

### Post-Launch Action Items (Priority Order)

1. **Configure Sentry DSN** — set credentials in production environment, verify end-to-end
2. **Restrict Mapbox token** — dashboard action, limit to next-office.io domains
3. **Fix LP conversion tag** — replace hardcoded placeholder with env var reads
4. **Optional: env typed accessor** — migrate API routes from `process.env.*` to `env` from `@/lib/env`

---

## Human Verification Items

Collected from all phase VERIFICATION.md files:

1. **Rate limit in production** (Phase 1) — submit >10 leads/min from same IP, verify 429
2. **XSS in browser** (Phase 1) — inject `<img onerror>` in transit data, verify no execution
3. **Sentry live error capture** (Phase 2) — throw error in production, verify in Sentry dashboard
4. **Sentry source map uploads** (Phase 2) — configure GitHub secrets, verify readable traces
5. **CSRF rejection** (Phase 3) — POST to /api/leads without token, verify 403
6. **Dedup flow** (Phase 3) — submit duplicate lead, verify idempotent response
7. **Email latency** (Phase 3) — submit lead, verify API response <500ms
8. **404 page visual** (Phase 5) — navigate to /nonexistent-page, verify branded page
9. **Photo gallery focus trap** (Phase 5) — Tab key cycling in fullscreen overlay
10. **Lead form submit interaction** (Phase 5) — verify spinner during submission
11. **Homepage social sharing** (Phase 6) — share on LinkedIn/Slack, verify OG image
12. **Lead form GA4 event** (Phase 6) — submit with DevTools, verify generate_lead
13. **Rich Results breadcrumbs** (Phase 6) — listing URL in Google Rich Results Test

---

*Audited: 2026-02-26*
*Auditor: Claude (gsd-audit-milestone orchestrator)*
